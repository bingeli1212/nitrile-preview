---
title: The "uplatex" translation
---


# The "uplatex" translation

The "uplatex" translation is done by setting the "tex" front matter key to "uplatex".
The generated TEX file is to be compiled by running the "uplatex" program. The output
of this program is a DVI file. This file can be converted to a PDF file by running
the "dvipdfmx" program.

    $ uplatex mytex
    $ dvipdfmx mytex

# The "ptex/uptex" engine

The "ptex" engine is designed and developed by people in Japan to process input
files with 2-byte Japanese language encoding. The "uptex" is an upgrade of this 
same engine but that is designed to read UTF-8 encoded input.


# The "pxbabel" package

The generated TEX file contains a \usepackage command that includes the "pxbabel" package.
This package is designed to be used with "uplatex" program. It serves the purpose
of provide a way to designate part of the text as with a different East Asian language, namely:
japanese, schinese, tchinese, and korean. 

    \usepackage[japanese,schinese,tchinese,korean,english]{pxbabel}
    \begin{document}
    \foreignlanguage{japanese}{日本語}
    \end{document}


# DVIPDFMx Configuration files

DVIPDFMx no longer use dvipdfm as its application name. It means that DVIPDFMx
finds its configuration file at $TEXMF/dvipdfmx/dvipdfmx.cfg. Moreover, fontmap
files with DVIPS/pdfTeX format are supported too. See dvipdfmx.cfg.


# Truetype fonts

Truetype fonts with Mac OS X data/resource fork format are supported. It means
that almost all fonts including Zapfino.dfont in Mac OS X can be used with
DVIPDFMx.


# Inserting PDF pages

New 'page' option is introduced in PDF image inclusion. With the DVIPDFMx
driver for LaTeX graphics package, dvipdfmx.def, it is possible to include a
specified page in a PDF file, for example,

    \includegraphics[page=4]{a.pdf}

Moreover, .xbb is automatically generated if latex -shell-escape is used. MPS
files generated by MetaFun are supported too. Improved PDF document parsing,
and a few bugs were fixed. See ChangeLog for more details.


# Font and Encoding

DVIPDFMx supports various encodings in rather unintuitive way (due to various
reasons). For 8-bits encodings, it supports .enc format glyph encoding file
(used by dvips program) with few extensions undocumented here and remapping of
a set of 8-bit encoded TeX fonts to a single double-byte font with SFD file
support. And it can also support various multibyte encodings (excluding
state-full encoding) by loading PostScript CMap resource. Not all encodings are
supported depending on format of font to be used.

The following font formats are supported:

1) PostScript Type1
\\
PostScript Type1 format font is supported as in dvipdfm, but they are converted
to CFF format (for reducing PDF file size when compression is enabled) and
always embedded as a font subset. Currently usable only with 8-bit encodings.
Multiple-Master font is not supported yet.

2) OpenType
\\
All flavours of OpenType fonts is supported: OpenType font with PostScript
outline, TrueType outline, and as CIDFont in an OpenType wrapper. However, as
DVIPDFMx is not a text manipulation program nor layout program, it supports
only a part of OpenType features; partial support for OpenType GSUB Layout
table just enough for supporting vertical writing, some of ligatures,
small-caps, and so on.

3) TrueType
\\
Both TrueType and TTC format is supported. There are several enhancement to
dvipdfm including font subsetting. They may be embedded as a TrueType font or
as a CIDFontType 2 CIDFont.


# PDF Encryption

Encrypted PDF files can be generated if the -S option is given. The key bits
(40-128 bits) and the permission flags are specified either in the
configuration file dvipdfmx.cfg or with command line options -K (for key bits)
and -P (for permission flags).


# Graphics Support

All graphics format supported in dvipdfm is also supported in DVIPDFMx with few
improvement: A little enhancement on PDF inclusion (can handle dvipdfm output
PDF). Improved PNG support; alpha channel and tRNS chunk is fully supported.
Indexed-color image is no longer converted to 24-bit RGB color image.
Experimental embedded ICC profile support for JPEG and PNG format images.
Windows BMP format is also supported in DVIPDFMx.

Nearly arbitrary graphics format can be supported with the help of external
program as long as they can be translated into single page PDF image (like
dvipdfm). There are few improvement on interpreting and translating PostScript
code inserted with \special command or read from MetaPost output PostScript
files. But there are still many limitations and restrictions.


# Example

Following is an example TEX file.

    \documentclass{utarticle}
    \usepackage{color}
    \begin{document}
    \section{芥川龍之介「るしへる」}
    破提宇子と云う天主教を弁難した書物のある事は、...
    \par
    破提宇子の流布本は、華頂山文庫の蔵本を、...
    \par
    中でも同書の第三段は、悪魔の起源を論じた一章であるが、...
    \par
    予は以下にこの異本第三段を紹介して、聊巴毗弇の前に姿を現した、...
    \section{樋口一葉「大つごもり」}
    お母樣御機嫌よう好い新年をお迎へなされませ、左樣ならば參りますと、
    暇乞わざと恭しく、お峰下駄を直せ、お玄關からお歸りではないお出
    かけだぞとづぶ〳〵しく大手を振りて、行先は何處、父が涙は一夜の
    騷ぎに夢とやならん、持つまじきは放蕩息子、持つまじきは放蕩を仕立
    る繼母ぞかし。鹽花こそふらね跡は一先掃き出して、...
    \end{document}

Following is how to compile a TEX file.

    euptex -fmt=uplatex example.tex              
    dvipdfmx example.dvi              
    open example.pdf              



# Change fonts for Korean language

Pxbabel does nothing about "physical" font settings. So, you have to 
tell dvipdfmx which font you are going to use by modifying the
"fontmap" file that comes with TexLive. For TexLive2021 this file
is

    /usr/local/texlive/2021/texmf-var/fonts/map/dvipdfmx/updmap/kanjix.map

The easiest way to do that may be:

    \documentclass[a4paper,uplatex]{jsarticle}
    \usepackage[english]{babel}
    \usepackage[main=japanese]{pxbabel}
    \AtBeginDvi{\special{pdf:mapline uphysmjm-h UniKS-UTF16-H UnBatang.ttf}}
    \AtBeginDvi{\special{pdf:mapline uphysmjm-v UniKS-UTF16-V UnBatang.ttf}}
    \AtBeginDvi{\special{pdf:mapline uphygt-h UniKS-UTF16-H UnDotum.ttf}}
    \AtBeginDvi{\special{pdf:mapline uphygt-v UniKS-UTF16-V UnDotum.ttf}}
    \begin{document}
    \foreignlanguage{korean}{내가득합니다}%
    \foreignlanguage{korean}{\textgt{내가득합니다}}
    \end{document}

Of course, first you have to install these fonts (.ttf) into your $TEXMFLOCAL 
(e.g. /usr/local/texlive/texmf-local/fonts/truetype/unfonts), and run sudo mktexlsr.



# The pxrubrica or okumacro packages

Both of the two packages mentioned above are supposed to provide
the \ruby command that is considered to be a better version 
of the one from the "ruby" package. 

In fact, the "pxrubrica" package does not work work with "memoir" and "uplatex".
It has a compiler error saying the count does not match.

The "okumacro" package is a better choice as it does not reduce the font size 
too much as opposed to "ruby" package, and on top of that the ruby annotation
are spread out to cover the entire length of the base text as opposed to the 
"ruby" package which serves to center all annotation text.



# The CJK pakcage

The CJK package is not supported by "platex" or "uplatex". 
Following is a post by the maintainer of the "platex":

  I'm a current maintainer of platex, and I tried to support CJK package but it
  failed. Some people may think that it's possible, but pTeX engine tries to
  translate “as much input characters as possible” into Japanese fonts; it means
  that the result is almost always far from acceptable, because some Chinese
  characters are printed in Japanese kanji variant, and vice versa. I mean, “CJK
  package cannot be used with pLaTeX because of limitations in the implementation
  of pTeX engine and some compatibility issue.” – Hironobu YAMASHITA




# Known issues

- TexLive2021 installation for OSX has a font problem such that \language[schinese] and \language[tchinese] and
  \language[korean] does not present the correct font for the text and thus none of the above texts
  are shown correctly. TexLive2022 seems to have fixed the problem. On the other hand, TexLive2021 for WIN
  does not exhibit this problem.

  

